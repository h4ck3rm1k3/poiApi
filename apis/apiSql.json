{
  "select": {
    "nodes": [
      "SELECT",
      "  nodes.node_id as id,",
      "  nodes.visible,",
      "  nodes.version,",
      "  nodes.changeset_id as changeset,",
      "  nodes.timestamp AT TIME ZONE 'UTC' as timestamp,",
      "  users.display_name as user,",
      "  changesets.user_id as uid,",
      "  nodes.latitude/10000000::float as lat,",
      "  nodes.longitude/10000000::float as lon,",
      "  to_json(hstore_from_kv('node_tags', 'node_id', nodes.node_id, nodes.version)) as tag",
      "FROM",
      "  nodes",
      "  JOIN changesets ",
      "    ON nodes.changeset_id = changesets.id",
      "   JOIN users",
      "     ON changesets.user_id = users.id"
    ],
    "ways": [
      "SELECT",
      "  ways.way_id as id,",
      "  ways.visible as visible,",
      "  ways.version as version,",
      "  ways.changeset_id as changeset,",
      "  ways.timestamp AT TIME ZONE 'UTC' as timestamp,",
      "  users.display_name as user,",
      "  changesets.user_id as uid,",
      "  to_json(ARRAY(select node_id from way_nodes where way_id = ways.way_id AND version = ways.version ORDER BY sequence_id)) AS nd,",
      "  to_json(hstore_from_kv('way_tags', 'way_id', ways.way_id, ways.version)) as tag",
      "FROM",
      "  ways",
      "  JOIN changesets",
      "    ON ways.changeset_id = changesets.id",
      "  JOIN users",
      "    ON changesets.user_id = users.id"
    ]
  },
  "where": {
    "where": "WHERE",
    "nodes": {
      "id": "nodes.node_id = '{{id}}' AND nodes.version in (SELECT MAX(version) FROM nodes WHERE node_id = '{{id}}')",
      "history": "nodes.node_id = '{{id}}'"
    },
    "ways": {
      "id": "ways.way_id = '{{id}}' AND ways.version IN (SELECT MAX(version) FROM ways WHERE way_id = '{{id}}')",
      "history": "ways.way_id = '{{id}}'"
    }
  }
}
